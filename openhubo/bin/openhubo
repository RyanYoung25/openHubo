#!/usr/bin/env python
#
#Set up ipdb for better exception handling and debugging
import IPython
from IPython.core import ultratb
from openravepy import raveLogInfo

from fnmatch import fnmatch
import os as _os
import sys as _sys
import openhubo as _oh
import runpy as _runpy
import re as _re
import subprocess

print "Using Ipython for exceptions..."
_sys.excepthook = ultratb.FormattedTB(mode='Verbose',
                                     color_scheme='Linux', call_pdb=1)

(options,scriptname)=_oh.get_options()

if options.example or scriptname:

    if scriptname:
        subprocess.call('python '+scriptname)
    else:
        expath=_os.environ['OPENHUBO_DIR'] + '/examples/'
        for f in _os.listdir(expath):
            if fnmatch(f, options.example):
                raveLogInfo("Found example {}".format(options.example))
                cmd=['python',expath + f]
                print cmd
                subprocess.call(cmd)
                break
else:
    #Enable interactive mode and load a simple environment
    (env,options)=_oh.setup('qtcoin')
    env.SetDebugLevel(3)

    #Options structure is populated by command line as well as easily in code
    [robot,ctrl,ind,ghost,recorder]=_oh.load_scene(env,options)

    env.StartSimulation(_oh.TIMESTEP)

